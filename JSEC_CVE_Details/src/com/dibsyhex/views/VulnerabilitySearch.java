package com.dibsyhex.views;

import com.dibsyhex.controllers.ESController;
import com.dibsyhex.views.JsonListener;
import com.dibsyhex.views.VulnerabilitySearchResponse;
import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.FlowLayout;
import java.awt.LayoutManager;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.json.JsonArray;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;

public class VulnerabilitySearch
extends JPanel
implements ActionListener {
    public JTextField search;
    public JButton submit;
    public JLabel text;
    public JPanel searchArea = new JPanel();
    private JsonListener stringListener;
    public VulnerabilitySearchResponse vulnerabilitySearchResponse;

    public VulnerabilitySearch() {
        this.searchArea.setLayout(new FlowLayout());
        this.vulnerabilitySearchResponse = new VulnerabilitySearchResponse();
        this.search = new JTextField(20);
        this.text = new JLabel("Enter platform or language or CVE");
        this.submit = new JButton("Search");
        this.submit.addActionListener(this);
        this.setLayout(new BorderLayout());
        this.searchArea.add(this.text);
        this.searchArea.add(this.search);
        this.searchArea.add(this.submit);
        this.add((Component)this.searchArea, "North");
        this.add((Component)this.vulnerabilitySearchResponse, "Center");
        this.setStringListener(new JsonListener(){

            @Override
            public void returnedText(JsonArray jsonArray) {
                VulnerabilitySearch.this.vulnerabilitySearchResponse.printPreety(jsonArray);
            }
        });
    }

    public void setStringListener(JsonListener stringListener) {
        this.stringListener = stringListener;
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        String query = this.search.getText();
        ESController esController = new ESController(query);
        esController.process();
        JsonArray jsonArray = esController.getJsonArray();
        if (this.stringListener != null) {
            this.stringListener.returnedText(jsonArray);
        }
    }

}

